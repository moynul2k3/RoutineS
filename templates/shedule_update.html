{% extends "base.html" %}
{% load static tailwind_tags %}
{% load update_shedule_filters %}
{% block title %}| Shedule{% endblock %}

{% block content %}
<div class="px-2 md:px-6 max-md:px-2 w-full mx-auto max-md:py-20 md:py-32">
    <div class="flex flex-col items-center w-full overflow-hidden">
        <p class="text-xl font-bold text-white text-center">Hi. {{ user.name }}</p>
        <p class="text-4xl font-bold text-amber-500 text-center">{{ user.department.name }}</p>
        <p class="text-sm font-bold text-amber-500 text-center">(batch: {{ user.batch.name }})</p>
        <hr class="max-md:w-[70%] md:w-[40%] mt-3">
    </div>

    {% if messages %}
        <div class="mt-4 text-center">
            {% for message in messages %}
                <p class="text-green-400 font-semibold">{{ message }}</p>
            {% endfor %}
        </div>
    {% endif %}
    <form method="post" action="." class="mb-20">
        <div id="scrollContainer" class="overflow-x-auto cursor-grab">
            {% csrf_token %}
            <table class="table-auto min-w-full max-lg:min-w-[2000px] mt-10 max-md:mb-4 md:mb-4 border-collapse">
                <thead class="text-amber-400 text-sm">
                    <tr class="border-b border-gray-600">
                        <th class="text-left py-2">Day</th>
                        {% for shift in shifts %}
                            <th colspan="3" class="text-center min-w-[400px]">{{ shift.duration }}</th>
                        {% endfor %}
                    </tr>
                    <tr class="border-b border-gray-600">
                        <th></th>
                        {% for shift in shifts %}
                            <th class="text-center">Course</th>
                            <th class="text-center">Room</th>
                            <th class="text-center">Faculty</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody class="text-xs text-white">
                    {% for day in days %}
                        <tr class="border-b border-white/10">
                            <td class="py-4 font-semibold text-left">{{ day|title }}</td>
                            {% for shift in shifts %}
                                {% with shedule_day=shedule|get_item:day %}
                                    {% if shedule_day %}
                                        {% with detail=shedule_day.details.all|get_shift:shift %}
                                            {% if detail %}
                                                <td class="bg-white/10">
                                                    <input type="text" 
                                                        name="routine_{{ day }}_{{ shift.id }}_subject" 
                                                        value="{{ detail.course }}" 
                                                        placeholder="Course"
                                                        class="h-full w-full text-white bg-white/10 placeholder-white border border-white/20 px-2 rounded-sm" />
                                                </td>
                                                <td class="bg-white/10">
                                                    <input type="text" 
                                                        name="routine_{{ day }}_{{ shift.id }}_room" 
                                                        value="{{ detail.room }}" 
                                                        placeholder="Room"
                                                        class="h-full w-full text-white bg-white/10 placeholder-white border border-white/20 px-2 rounded-sm" />
                                                </td>
                                                <td class="bg-white/10">
                                                    <input type="text" 
                                                        name="routine_{{ day }}_{{ shift.id }}_faculty" 
                                                        value="{{ detail.faculty }}" 
                                                        placeholder="Faculty"
                                                        class="h-full w-full text-white bg-white/10 placeholder-white border border-white/20 px-2 rounded-sm" />
                                                </td>
                                            {% else %}
                                                {% include "empty_inputs.html" %}
                                            {% endif %}
                                        {% endwith %}
                                    {% else %}
                                        {% include "empty_inputs.html" %}
                                    {% endif %}
                                {% endwith %}
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="text-center mt-6">
            <button type="submit" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-6 rounded">
                Save Schedule
            </button>
        </div>
    </form>
</div>

<!-- Drag Scroll Script -->
<script>
    function enableDragScroll(containerId) {
        const slider = document.getElementById(containerId);
        let isDown = false;
        let startX;
        let scrollLeft;

        slider.addEventListener('mousedown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            isDown = true;
            slider.classList.add('cursor-grabbing', 'select-none');
            slider.classList.remove('cursor-grab');
            startX = e.pageX - slider.offsetLeft;
            scrollLeft = slider.scrollLeft;
            e.preventDefault();
        });

        slider.addEventListener('mouseleave', () => {
            isDown = false;
            slider.classList.add('cursor-grab');
            slider.classList.remove('cursor-grabbing', 'select-none');
        });

        slider.addEventListener('mouseup', () => {
            isDown = false;
            slider.classList.add('cursor-grab');
            slider.classList.remove('cursor-grabbing', 'select-none');
        });

        slider.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - slider.offsetLeft;
            const walk = (x - startX) * 2;
            slider.scrollLeft = scrollLeft - walk;
        });
    }

    // Enable drag scroll for multiple containers
    enableDragScroll('scrollContainer');
    enableDragScroll('scrollContainer2');
</script>


{% endblock %}
