{% extends "base.html" %}
{% load static tailwind_tags %}
{% load shedule_filters %}
{% block title %}| Shedule{% endblock %}

{% block content %}
<div class="px-2 md:px-6 max-md:px-2 w-full  mx-auto max-md:py-20 md:py-32">
    <div class="flex flex-col items-center w-full overflow-hidden">
        <p class="text-xl font-bold text-white text-center">Hi. {{ user.name }}</p>
        <p class="text-4xl font-bold text-amber-500 text-center">{{ user.department.name }}</p>
        <p class="text-sm font-bold text-amber-500 text-center">(batch: {{ user.batch.name }})</p>
        <hr class="max-md:w-[70%] md:w-[40%] mt-3">
    </div>
    <div id="scrollContainer" class="overflow-x-scroll cursor-grab select-none mb-20">
        <table class="table-auto min-w-full max-lg:min-w-[2000px] mt-10 max-md:mb-4 md:mb-4">
            <thead class="text-amber-400 text-sm">
                <tr class="border-gray-400">
                    <th>Day</th>
                    {% for shift in shifts %}
                        <th colspan="3" class="rightSection min-w-[400px]">{{ shift.duration }}</th>
                    {% endfor %}
                </tr>
                <tr>
                    <th></th>
                    {% for shift in shifts %}
                        <th class=" rightSection">Course</th>
                        <th class="">Room</th>
                        <th class="">Faculty</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody class="text-xs text-white/70">
                {% for day in days %}
                    <tr>
                        <td class="py-20 font-semibold">{{ day|title }}</td>
                        {% for shift in shifts %}
                            {% with shedule_day=shedule|get_day:day %}
                                {% if shedule_day %}
                                    {% with detail=shedule_day.details.all|get_shift:shift %}
                                        {% if detail %}
                                            <td class="rightSection bg-white/5 ">{{ detail.course }}</td>
                                            <td class="bg-white/5 ">{{ detail.room }}</td>
                                            <td class="bg-white/5 ">{{ detail.faculty }}</td>
                                        {% else %}
                                            <td class="rightSection"></td>
                                            <td ></td>
                                            <td ></td>
                                        {% endif %}
                                    {% endwith %}
                                {% else %}
                                    <td class="rightSection"></td>
                                    <td ></td>
                                    <td ></td>
                                {% endif %}
                            {% endwith %}
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% if request.user.is_CR or request.user.is_staff or request.user.is_superuser %}
        <div class="text-center my-6">
            <a href="{% url 'shedule_update' %}" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-6 rounded">
                Update Schedule
            </a>
        </div>
    {% endif %}
</div>
<script>
  const slider = document.getElementById('scrollContainer');
  let isDown = false;
  let startX;
  let scrollLeft;

  slider.addEventListener('mousedown', (e) => {
    isDown = true;
    slider.classList.add('cursor-grabbing');
    slider.classList.remove('cursor-grab');
    startX = e.pageX - slider.offsetLeft;
    scrollLeft = slider.scrollLeft;
    e.preventDefault();
  });

  slider.addEventListener('mouseleave', () => {
    isDown = false;
    slider.classList.add('cursor-grab');
    slider.classList.remove('cursor-grabbing');
  });

  slider.addEventListener('mouseup', () => {
    isDown = false;
    slider.classList.add('cursor-grab');
    slider.classList.remove('cursor-grabbing');
  });

  slider.addEventListener('mousemove', (e) => {
    if (!isDown) return;
    e.preventDefault();
    const x = e.pageX - slider.offsetLeft;
    const walk = (x - startX) * 2; // scroll speed
    slider.scrollLeft = scrollLeft - walk;
  });
</script>


{% endblock %}