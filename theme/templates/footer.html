{% load static tailwind_tags %}

<div class="relative overflow-hidden py-16 sm:py-24 lg:py-32 bg-white/10 backdrop-blur-sm z-30 max-md:pb-32">
    <div class="mx-auto max-w-7xl px-2 md:px-6 lg:px-8">
        <div class="mx-auto grid max-w-2xl grid-cols-1 gap-x-8 gap-y-16 lg:max-w-none lg:grid-cols-2">
            <div class="max-w-xl lg:max-w-lg">
                <h2 class="text-3xl md:text-4xl font-semibold tracking-tight text-white">
                    Subscribe to our newsletter
                </h2>
                <p class="mt-2 md:mt-4 text-sm md:text-lg text-gray-300">
                    Stay updated with the latest news and updates. We respect your inbox â€” only valuable content, no spam.
                </p>

                <form id="subscribeForm" method="post" class="mt-6 flex max-w-md gap-x-1 md:gap-x-4">
                    {% csrf_token %}
                    <label for="emailInput" class="sr-only">Email address</label>
                    <input
                        id="emailInput"
                        name="email"
                        type="email"
                        autocomplete="email"
                        required
                        class="min-w-0 flex-auto rounded-md bg-white/5 px-3.5 py-2 text-base text-white outline-[1px] -outline-offset-1 outline-white/10 placeholder:text-white/50 focus:outline-[1px] focus:-outline-offset-[1px] focus:outline-pink-500/60 sm:text-sm/6"
                        placeholder="Enter your email"
                    />
                    <button
                        type="submit"
                        class="flex-none rounded-md bg-pink-500/60 px-5 py-1 md:py-2 text-sm font-semibold text-white shadow-xs hover:bg-pink-400/50 cursor-pointer "
                    >
                        Subscribe
                    </button>
                </form>
            </div>

            <dl class="grid grid-cols-1 gap-x-8 gap-y-10 sm:grid-cols-2 lg:pt-2">
                <div class="flex flex-col items-start">
                    <div class="rounded-md bg-white/5 p-2 ring-1 ring-white/10">
                        <svg class="size-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z" />
                        </svg>
                    </div>
                    <dt class="mt-4 text-base font-semibold text-white">Weekly articles</dt>
                    <dd class="mt-2 text-sm md:text-lg text-gray-400">Get insightful articles delivered every Friday. No fluff.</dd>
                </div>

                <div class="flex flex-col items-start">
                    <div class="rounded-md bg-white/5 p-2 ring-1 ring-white/10">
                        <svg class="size-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M10.05 4.575a1.575 1.575 0 1 0-3.15 0v3m3.15-3v-1.5a1.575 1.575 0 0 1 3.15 0v1.5m-3.15 0 .075 5.925m3.075.75V4.575m0 0a1.575 1.575 0 0 1 3.15 0V15M6.9 7.575a1.575 1.575 0 1 0-3.15 0v8.175a6.75 6.75 0 0 0 6.75 6.75h2.018a5.25 5.25 0 0 0 3.712-1.538l1.732-1.732a5.25 5.25 0 0 0 1.538-3.712l.003-2.024a.668.668 0 0 1 .198-.471 1.575 1.575 0 1 0-2.228-2.228 3.818 3.818 0 0 0-1.12 2.687M6.9 7.575V12m6.27 4.318A4.49 4.49 0 0 1 16.35 15m.002 0h-.002" />
                        </svg>
                    </div>
                    <dt class="mt-4 text-base font-semibold text-white">No spam</dt>
                    <dd class="mt-2 text-sm md:text-lg text-gray-400">No ads or noise. Only valuable updates.</dd>
                </div>
            </dl>
        </div>
    </div>
</div>

<!-- Notification Box -->
<div id="globalMessageBox"
    class="hidden fixed bottom-4 left-1/2 transform -translate-x-1/2  text-white text-sm font-medium px-5 py-3 rounded shadow-lg z-50 transition-all duration-300 ease-in-out">
</div>

<!-- jQuery + AJAX Logic -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function showGlobalMessage(message, bgClass) {
        const box = $('#globalMessageBox');
        box.removeClass('bg-green-600 bg-red-500 bg-yellow-500').addClass(bgClass).text(message).fadeIn();

        setTimeout(() => {
            box.fadeOut();
        }, 4000);
    }

    $('#subscribeForm').on('submit', function (e) {
        e.preventDefault();

        const email = $('#emailInput').val();
        const csrfToken = $("input[name='csrfmiddlewaretoken']").val();

        $.ajax({
            url: "{% url 'subscribe_ajax' %}",
            type: 'POST',
            data: {
                'email': email,
                'csrfmiddlewaretoken': csrfToken
            },
            success: function (response) {
                showGlobalMessage(response.message || 'Subscribed successfully!', 'bg-pink-500/70');
                $('#emailInput').val('');
            },
            error: function (xhr) {
                const data = xhr.responseJSON;
                const colorClass = data?.status === 'info' ? 'bg-yellow-500/70' : 'bg-red-500/70';
                const msg = data?.message || 'Something went wrong.';
                showGlobalMessage(msg, colorClass);
            }
        });
    });
</script>
